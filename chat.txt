最終的に作りたいもの。

Scrapbox, workflowy のクローンから始める。
ユーザーからの操作は vscodeライクに、特にマルチカーソルや検索・置換は使える様に。
検索は正規表現もワイルドカードも使える様に。
Notionの DBみたいな物があるが、パフォーマンスと機能はSQLの様にしたい。
SQLに詳しくない人も使えるようにはしたいが、その為にパフォーマンスを落としたくはない。
DB等はパフォーマンスの為に、worker threadで行う。web assemblyで実装する。
DBは基本、クライアント側で処理したい。
DBのデータはFluid Frameworkで管理する。
DBのデータを表示するチャートはリッチにしたい。リアクティブにしたいが、リアルタイムまでは要求せず、パフォーマンス優先で数分の遅れは許容する。

上記の内容は既にドキュメント化、実装済みの物もあります。
これらで不足していて、次に実装すると良いものを実装するタスクを作る為のボタンを表示して下さい。

以下は AGENTS.mdに追加して下さい。
並行してAIがコーディングする中で、一部で機能の重複やドキュメントの重複・齟齬が起こる場合があります。
過去のベストプラクティスの参照・記録・更新を都度行ってください。
随時、実装計画のドキュメントの更新をして下さい。



Fluid Frameworkと svelteを使ったアプリを作りたい。 Fluid FrameworkのサーバーはローカルでRouterliciousを使う。 dockerコンテナ内で作業したいから、 .devcontainerを作りたい。

この情報だけ十分なら設定ファイルを作成して。

不十分なら何が不十分か教えて。

最新のAPIドキュメントを確認しながら作業して。
代替方法の提案をするとき、コードは出力しないで。
拡張機能のバグだと思うが、最初の候補のコードが表示されなくなる。


https://www.npmjs.com/package/fluid-framework
https://fluidframework.com/docs/start/tree-start
https://learn.microsoft.com/en-us/azure/azure-fluid-relay/how-tos/connect-fluid-azure-service





e2e testの実行して、エラーの解消をして。
cd /workspace/client && npm run test:e2e:xvfb
で実行できる。


/workspace/client/logs/browser.log
で記録されているエラーに対処して。



http://192.168.50.13:7080/
はテスト用のサーバー




テストの動作確認をして下さい。

cd /workspace/client && npx playwright test {test file path}
にて、テストを実行できます。

対象のテスト
　/workspace/client/e2e/core/CLM-0001.spec.ts

手順
　以下の手順に過不足があれば実行前に手順の改善案を出して下さい。
　コマンドラインから、このテストをheadlessモードで実行して下さい。
　エラーがなければそれで終了です。
　エラーがある場合は続けて下さい。
　このテストファイルを分析して、各テストケースの目的と確認すべき挙動を確認してください
　playwright-mcpを使用して、headedブラウザでテスト環境（http://192.168.50.13:7080/）にアクセスしてください
　テストコードをトレースして、実際にブラウザで手動でテストコードの内容を行って下さい。
　期待通りに動作するか確認してください。
　異常があれば原因の説明をしてください。
　修正内容方針の説明をして、実際の修正は適用しないで下さい。
　テストレポートの表示はしないで下さい。
　テストの修正をするか、コードの修正をするかは私が決めます。

テスト用のサーバー
　http://192.168.50.13:7080/
クライアントのログがここにあります。必要であれば、アクセス後にこちらを確認して下さい。
　/workspace/client/logs/test-browser.log
テスト用のSveltKit serverのログがここにあります。必要であれば、アクセス後にこちらを確認して下さい。
　/workspace/server/logs/test-svelte-kit.log
API serverのログがここにあります。必要であれば、アクセス後にこちらを確認して下さい。
　/workspace/server/logs/test-auth-service-tee.log




今回のテスト確認対象は



開発用のサーバー
http://192.168.50.13:7070/
へアクセスして、正常に動作していることを確認して。
クライアントのログがここにある。必要であれば、アクセス後にこちらを確認して。
/workspace/client/logs/browser.log
開発用のSveltKit serverのログがここにある。必要であれば、アクセス後にこちらを確認して。
/workspace/server/logs/svelte-kit.log
API serverのログがここにある。必要であれば、アクセス後にこちらを確認して。
/workspace/server/logs/auth-service-tee.log



以下の手順に過不足があれば実行前に手順の改善案を出して下さい。

テストコード内のコメント充実化してください。
　テストファイルの先頭や各テストケースの前に「@description」や「@check」などのアノテーションを追加し、確認すべき挙動を詳細に記述して下さい。
　既存のテストコードはタイトルと実施内容に整合が取れていない物を含みます。
　その場合は適切な粒度でテストの分割、テストコードの修正、テストタイトルの修正を行って下さい。
　　実装が正しければテスト名を変更してください。
　　テスト名が表している意図が不足していれば、コードを追加・修正してください。
　後にこのコメントを活用して、あなたにテスト確認を行っていただきます。
　テストマニフェストの作成
　　以下のようなテストマニフェスト形式でテストケースの説明を先に作成してください。

/**
 * @file advanced-indent.spec.ts
 * @description インデント操作のテスト
 * 
 * @testcase インデント増加時の階層変更
 * @check Tabキーでインデント増加すると、アイテムが親アイテムの子になることを確認
 * 
 * @testcase インデント減少時の階層変更
 * @check Shift+Tabキーでインデント減少すると、アイテムが親の兄弟になることを確認
 */

全てのテストコードは git管理されているため、異常があれば元のファイルを復元可能です。



cd /workspace/client && npm run test:e2e:xvfb
で実行して、確認して。

先ほどの
カーソルの表示がされなくなった。
コピーペーストが動かなくなった。
を解決して。

これの確認のテストが不足していたら追加して。


Problems
cd /workspace/client && npm run check
を実行して、エラー又は警告を一つ修正して。


cd /workspace/client && npm run test:unit
を実行して、修正して。
リンターエラーは下記で確認してから直して。
cd /workspace/client && npm run check


commit
.venv\Scripts\Activate.ps1
を実行後、
git --no-pager diff --staged -- . ':(exclude).specstory' ':(exclude)chat.txt' ':(exclude)tips.txt' ':(exclude)docs'
で変更点を確認して、コミットメッセージを英語で書いて、コミットして下さい。
if there are not staged files, ignore them.




document.querySelectorAll('.cursor')


ありがとうございます。

セッションが長くなってきたので、セッションを新しくします。

次のセッションであなたが続きの作業をスムーズに行えるように、最初に書くプロンプトを作成して下さい。
次のセッションではまだ解決しきれないとしても、現状で認識している課題点を引き継いでください。
このセッションで行った内容を書く事よりも、次のセッションでの作業を効果的にするためのプロンプトを作成してください。
このセッションで行った内容はgitのコメントの方へ別途記載します。

順次作業を進めるようにとプロンプトに記載して下さい。





次の機能の実装をお願いします。





各テストファイルを一つずつ修正し、修正後は必ずテストを実行して確認してください。
作業の最後に、次のセッションであなたが続きの作業をスムーズに行えるように、最初に書くプロンプトを作成して下さい。
次のセッションではまだ解決しきれないとしても、現状で認識している課題点を引き継いでください。
このセッションで行った内容を書く事よりも、次のセッションでの作業を効果的にするためのプロンプトを作成してください。
このセッションで行った内容はgitのコメントの方へ別途記載します。

順次作業を進めるようにとプロンプトに記載して下さい。

次のテストの修正又は実装の修正をお願いします。
既に多くのテストはパスしているため、テスト環境は正常です。



次の機能の実装をお願いします。

下書きして置いた内容を指定時刻に公開します。
下書きの作成は Fluid frameworkの folkを使ってください。
作成した下書きは何らかの手段で firebase functionからアクセス可能にし、指定時刻になったらfirebase functionから書き込みます。
指定時刻の fuction実行は Cloud Tasksを利用して下さい。

機能毎に分割して作詞していってください。
まず、テスト用の folkを作成し、functionへ渡し、functionから fluid frameworkへ書き込むコア部分から実装とテストを始めてください。
下書き機能の実装を続行してください。

