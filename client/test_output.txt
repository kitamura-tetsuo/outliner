
> outliner@0.0.1 test:unit
> vitest run --project unit --coverage src/components/BacklinkPanel.test.ts

Loading test environment variables from .env.test
[38;5;142m[dotenvx@1.51.2] injecting env (36) from .env.test[39m
Loading test environment variables from .env.test
[38;5;142m[dotenvx@1.51.2] injecting env (0) from .env.test[39m
Loading test environment variables from .env.test
[38;5;142m[dotenvx@1.51.2] injecting env (0) from .env.test[39m
Loading test environment variables from .env.test
[38;5;142m[dotenvx@1.51.2] injecting env (0) from .env.test[39m
[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.
[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.

[1m[46m RUN [49m[22m [36mv4.0.17 [39m[90m/app/client[39m
      [2mCoverage enabled with [22m[33mv8[39m

{"level":20,"time":1769345919214,"pid":9537,"hostname":"devbox","module":"env","file":"env.ts","msg":"Using value for VITE_FIREBASE_FUNCTIONS_URL: http://127.0.0.1:57070"}
[90mstdout[2m | src/components/BacklinkPanel.test.ts
[22m[39m[env] [DEBUG]: Using value for VITE_FIREBASE_FUNCTIONS_URL: http://127.0.0.1:57070
[DEBUG] UserManager Init {
  isTestEnv: [33mtrue[39m,
  isProduction: [33mfalse[39m,
  useEmulator: [33mtrue[39m,
  VITE_USE_FIREBASE_EMULATOR: [32m'true'[39m,
  VITE_IS_TEST: [32m'true'[39m,
  MODE: [32m'test'[39m,
  DEV: [33mtrue[39m
}

{"level":20,"time":1769345919215,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"Initializing..."}
{"level":30,"time":1769345919217,"pid":9537,"hostname":"devbox","module":"firebase-app.ts","file":"firebase-app.ts","msg":"Firebase app: Initialized new instance"}
{"level":20,"time":1769345919228,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"Firebase Auth initialized, setting up listener"}
{"level":30,"time":1769345919229,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"Connecting to Auth emulator"}
{"level":30,"time":1769345919229,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"Connecting to Firebase Auth emulator at 127.0.0.1:59099"}
{"level":30,"time":1769345919230,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"Successfully connected to Firebase Auth emulator at 127.0.0.1:59099"}
{"level":30,"time":1769345919230,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"Successfully connected to Auth emulator"}
{"level":30,"time":1769345919230,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"[UserManager] E2E test environment detected, using Firebase auth emulator with test account"}
{"level":30,"time":1769345919231,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"[UserManager] Attempting E2E test login with test@example.com"}
{"level":20,"time":1769345919234,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"onAuthStateChanged triggered"}
{"level":30,"time":1769345919234,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"User signed out via onAuthStateChanged"}
{"level":20,"time":1769345919234,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"User signed out"}
{"level":20,"time":1769345919261,"pid":9537,"hostname":"devbox","module":"firebase-app.ts","file":"firebase-app.ts","msg":"Firebase app: Using globalThis cached instance"}
{"level":30,"time":1769345919261,"pid":9537,"hostname":"devbox","module":"firestoreStore.svelte.ts","file":"firestoreStore.svelte.ts","msg":"Firebase app initialized via central management"}
{"level":30,"time":1769345919262,"pid":9537,"hostname":"devbox","module":"firestoreStore.svelte.ts","file":"firestoreStore.svelte.ts","msg":"Connecting to Firestore emulator at 127.0.0.1:58080"}
{"level":30,"time":1769345919263,"pid":9537,"hostname":"devbox","module":"firestoreStore.svelte.ts","file":"firestoreStore.svelte.ts","msg":"Successfully connected to Firestore emulator"}
{"level":20,"time":1769345919336,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"onAuthStateChanged triggered"}
{"level":30,"time":1769345919336,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"User signed in via onAuthStateChanged"}
{"level":20,"time":1769345919337,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"handleUserSignedIn started"}
{"level":30,"time":1769345919337,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"Notifying listeners of successful authentication"}
{"level":20,"time":1769345919337,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"handleUserSignedIn completed successfully"}
{"level":30,"time":1769345919337,"pid":9537,"hostname":"devbox","module":"UserManager.ts","file":"UserManager.ts","msg":"[UserManager] Test user login successful"}
[90mstdout[2m | src/components/BacklinkPanel.test.ts
[22m[39mHELLO WORLD APP SCHEMA LOADED

[90mstdout[2m | src/components/BacklinkPanel.test.ts
[22m[39mINIT: Provisional Project set in store.svelte.ts { title: [32m'Untitled Project'[39m }

 [32mâœ“[39m [30m[42m unit [49m[39m src/components/BacklinkPanel.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 455[2mms[22m[39m
     [33m[2mâœ“[22m[39m should have correct ARIA attributes on toggle button [33m 355[2mms[22m[39m
12:58:41 PM [vite-plugin-svelte] src/components/ChartQueryEditor.svelte:4:17 This reference only captures the initial value of `item`. Did you mean to reference it inside a derived instead?
https://svelte.dev/e/state_referenced_locally
12:58:42 PM [vite-plugin-svelte] src/components/LandingContent.svelte:23:43 Using `on:click` to listen to the click event is deprecated. Use the event attribute `onclick` instead
https://svelte.dev/e/event_directive_deprecated
12:58:42 PM [vite-plugin-svelte] src/components/LandingContent.svelte:26:45 Using `on:click` to listen to the click event is deprecated. Use the event attribute `onclick` instead
https://svelte.dev/e/event_directive_deprecated
12:58:42 PM [vite-plugin-svelte] src/components/OutlinerItemAlias.svelte:9:27 This reference only captures the initial value of `item`. Did you mean to reference it inside a derived instead?
https://svelte.dev/e/state_referenced_locally
12:58:42 PM [vite-plugin-svelte] /app/client/src/components/OutlinerItem.svelte:1:8 `context="module"` is deprecated, use the `module` attribute instead
https://svelte.dev/e/script_context_deprecated
12:58:42 PM [vite-plugin-svelte] src/components/OutlinerItem.svelte:370:27 This reference only captures the initial value of `item`. Did you mean to reference it inside a derived instead?
https://svelte.dev/e/state_referenced_locally
12:58:43 PM [vite-plugin-svelte] src/components/SnapshotDiffModal.svelte:78:12 noninteractive element cannot have nonnegative tabIndex value
https://svelte.dev/e/a11y_no_noninteractive_tabindex

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m2 passed[39m[22m[90m (2)[39m
[2m   Start at [22m 12:58:36
[2m   Duration [22m 8.99s[2m (transform 1.38s, setup 1.76s, import 301ms, tests 455ms, environment 674ms)[22m

[34m % [39m[2mCoverage report from [22m[33mv8[39m
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
-------------------|---------|----------|---------|---------|-------------------
All files          |    2.53 |     1.82 |    3.56 |    2.54 |
 src               |       0 |      100 |       0 |       0 |
  hooks.client.ts  |       0 |      100 |     100 |       0 | 4
  hooks.server.ts  |       0 |      100 |       0 |       0 | 7-20
  hooks.ts         |       0 |      100 |       0 |       0 | 4-5
 src/auth          |    39.4 |    35.75 |   46.42 |      40 |
  UserManager.ts   |    39.4 |    35.75 |   46.42 |      40 | ...70-483,491-528
 src/components    |    1.26 |     0.25 |    1.72 |    1.02 |
  ...Picker.svelte |       0 |        0 |       0 |       0 | 26-150
  ...ponent.svelte |       0 |        0 |       0 |       0 | 56-267
  ...edHome.svelte |       0 |      100 |       0 |       0 | 13-47
  ...kPanel.svelte |   78.12 |    57.14 |   69.23 |      75 | ...72-173,176,186
  ...tPanel.svelte |       0 |        0 |       0 |       0 | 44-91
  ...Editor.svelte |       0 |        0 |       0 |       0 | 18-66
  Checklist.svelte |       0 |        0 |       0 |       0 | 37-90
  ...Thread.svelte |       0 |        0 |       0 |       0 | 36-410
  ...ryGrid.svelte |       0 |        0 |       0 |       0 | 10-156
  ...verlay.svelte |       0 |        0 |       0 |       0 | 13-1628
  ...bugger.svelte |       0 |        0 |       0 |       0 | 7-80
  ...xtArea.svelte |       0 |        0 |       0 |       0 | 20-368
  GraphView.svelte |       0 |        0 |       0 |       0 | 66-309
  ...nTable.svelte |       0 |        0 |       0 |       0 |
  ...ontent.svelte |       0 |      100 |       0 |       0 | 7
  ...review.svelte |       0 |        0 |       0 |       0 | 17-191
  ...icator.svelte |       0 |        0 |       0 |       0 | 36-274
  ...rAlert.svelte |       0 |        0 |       0 |       0 | 16-31
  ...erBase.svelte |       0 |        0 |       0 |       0 | 58-357
  ...erItem.svelte |       0 |        0 |       0 |       0 | 3-2199
  ...mAlias.svelte |       0 |        0 |       0 |       0 | 21-172
  ...hments.svelte |       0 |        0 |       0 |       0 | 17-98
  ...erTree.svelte |       0 |        0 |       0 |       0 | 34-2159
  PageList.svelte  |       0 |        0 |       0 |       0 | 49-141
  ...vatars.svelte |       0 |        0 |       0 |       0 | 13-33
  ...lector.svelte |       0 |        0 |       0 |       0 | 22-320
  ...Editor.svelte |       0 |      100 |       0 |       0 | 13-21
  SearchBox.svelte |       0 |        0 |       0 |       0 | 24-586
  ...hPanel.svelte |       0 |        0 |       0 |       0 | 46-555
  Sidebar.svelte   |       0 |        0 |       0 |       0 | 10-158
  ...alette.svelte |       0 |        0 |       0 |       0 | 7-48
  ...fModal.svelte |       0 |        0 |       0 |       0 | 34-144
  Toolbar.svelte   |       0 |        0 |       0 |       0 | 21-231
 src/lib           |    3.74 |     3.18 |    6.45 |    3.68 |
  Cursor.ts        |       0 |        0 |       0 |       0 | 36-2500
  ...Map.svelte.ts |       0 |        0 |       0 |       0 | 5-87
  CustomKeyMap.ts  |       0 |        0 |       0 |       0 | 3-84
  ...entHandler.ts |       0 |        0 |       0 |       0 | 22-2104
  ...kCollector.ts |       0 |        0 |       0 |       0 | 11-193
  debug.ts         |       0 |        0 |       0 |       0 | 9-126
  env.ts           |      50 |    27.02 |      50 |   58.33 | 21,32-43
  firebase-app.ts  |   57.44 |    38.63 |   83.33 |   57.77 | ...3,77-80,91-119
  ...nctionsUrl.ts |       0 |        0 |       0 |       0 | 14-70
  index.ts         |       0 |        0 |       0 |       0 | 6-28
  ...iewHandler.ts |       0 |        0 |       0 |       0 | 12-447
  lock.ts          |       0 |        0 |       0 |       0 | 5-55
  logger.ts        |   47.55 |    23.77 |   41.37 |   48.48 | ...06-419,427-446
  ...Doc.svelte.ts |       0 |        0 |       0 |       0 | 6-102
  ...ingMonitor.ts |       0 |        0 |       0 |       0 | 34-292
  ...ctSnapshot.ts |   12.59 |    11.82 |   13.33 |   12.38 | ...6,76-87,99-260
  ...leProvider.ts |       0 |        0 |       0 |       0 | 8-17
  ...ersistence.ts |       0 |        0 |       0 |       0 | 19-40
  ...ice.svelte.ts |       0 |        0 |       0 |       0 | 19-331
 src/lib/cursor    |       0 |        0 |       0 |       0 |
  CursorEditor.ts  |       0 |        0 |       0 |       0 | 28-731
  ...Formatting.ts |       0 |        0 |       0 |       0 | 10-194
  ...ttingUtils.ts |       0 |      100 |       0 |       0 | 7-42
  ...Navigation.ts |       0 |        0 |       0 |       0 | 34-550
  ...ationUtils.ts |       0 |        0 |       0 |       0 | 5-146
  ...rSelection.ts |       0 |        0 |       0 |       0 | 9-799
  ...ctionUtils.ts |       0 |        0 |       0 |       0 | 11-96
  ...Operations.ts |       0 |        0 |       0 |       0 | 24-395
  ...rTextUtils.ts |       0 |        0 |       0 |       0 | 19-203
  index.ts         |       0 |        0 |       0 |       0 |
 src/lib/search    |       0 |        0 |       0 |       0 |
  index.ts         |       0 |        0 |       0 |       0 | 17-140
  projectSearch.ts |       0 |        0 |       0 |       0 | 13-50
 src/lib/yjs       |       0 |        0 |       0 |       0 |
  connection.ts    |       0 |        0 |       0 |       0 | 12-713
  roomPath.ts      |       0 |        0 |       0 |       0 | 2-16
  service.ts       |       0 |        0 |       0 |       0 | 8-204
  testHelpers.ts   |       0 |        0 |       0 |       0 | 48-593
  tokenRefresh.ts  |       0 |        0 |       0 |       0 | 16-94
 src/routes        |       0 |        0 |       0 |       0 |
  +layout.svelte   |       0 |        0 |       0 |       0 | 37-435
  +layout.ts       |       0 |      100 |     100 |       0 | 3-4
  +page.svelte     |       0 |        0 |       0 |       0 | 8
 ...utes/[project] |       0 |        0 |       0 |       0 |
  +layout.svelte   |       0 |        0 |       0 |       0 | 15-73
  +page.svelte     |       0 |        0 |       0 |       0 | 14-165
 ...roject]/[page] |       0 |        0 |       0 |       0 |
  +layout.svelte   |       0 |        0 |       0 |       0 | 12-40
  +layout.ts       |       0 |        0 |     100 |       0 | 1
  +page.svelte     |       0 |        0 |       0 |       0 | 25-644
 ...t]/[page]/diff |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 | 9-29
 ...page]/schedule |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 | 31-646
 ...project]/graph |       0 |      100 |       0 |       0 |
  +page.svelte     |       0 |      100 |       0 |       0 | 9-10
  +page.ts         |       0 |      100 |     100 |       0 | 1
 ...ject]/settings |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 | 41-299
 .../api/[...path] |       0 |        0 |       0 |       0 |
  +server.ts       |       0 |        0 |       0 |       0 | 4-34
 ...e-health-check |       0 |        0 |       0 |       0 |
  +server.ts       |       0 |        0 |       0 |       0 | 5-31
 ...list-schedules |       0 |        0 |       0 |       0 |
  +server.ts       |       0 |        0 |       0 |       0 | 4-35
 ...pi/rotate-logs |       0 |        0 |       0 |       0 |
  +server.ts       |       0 |        0 |       0 |       0 | 4-48
 ...i/save-project |       0 |        0 |       0 |       0 |
  +server.ts       |       0 |        0 |       0 |       0 | 4-34
 ...utes/checklist |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 | 8-22
 ...clipboard-test |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 | 8-393
  +page.ts         |       0 |      100 |     100 |       0 | 1
 ...routes/counter |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 |
 src/routes/debug  |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 | 24-298
 src/routes/demo   |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 |
 ...demo/paraglide |       0 |      100 |       0 |       0 |
  +page.svelte     |       0 |      100 |       0 |       0 | 18-34
  +page.ts         |       0 |      100 |     100 |       0 | 1
 src/routes/graph  |       0 |      100 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 |
  +page.ts         |       0 |      100 |     100 |       0 | 1
 src/routes/min    |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 | 24-99
 ...cts/containers |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 | 23-199
 ...rojects/delete |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 | 16-154
 ...outes/schedule |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 | 23-58
 ...outes/settings |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 |
 src/routes/sql    |       0 |      100 |       0 |       0 |
  +page.svelte     |       0 |      100 |       0 |       0 | 10-11
 src/routes/table  |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 | 16-55
 ...s/yjs-outliner |       0 |        0 |       0 |       0 |
  +page.svelte     |       0 |        0 |       0 |       0 | 12-41
 src/schema        |    6.02 |     4.54 |   12.38 |    5.83 |
  app-schema.ts    |   11.97 |     8.27 |   22.58 |   11.52 | ...68-569,574-591
  yjs-schema.ts    |       0 |        0 |       0 |       0 | 7-578
 src/services      |       0 |        0 |       0 |       0 |
  ...entService.ts |       0 |        0 |       0 |       0 | 8-33
  ...istService.ts |       0 |        0 |       0 |       0 | 24-106
  editMapper.ts    |       0 |        0 |       0 |       0 | 18-33
  ...ortService.ts |       0 |        0 |       0 |       0 | 4-148
  index.ts         |       0 |        0 |       0 |       0 |
  ...uleService.ts |       0 |        0 |       0 |       0 | 17-83
  ...hotService.ts |       0 |        0 |       0 |       0 | 11-109
  sqlService.ts    |       0 |        0 |       0 |       0 | 19-243
  syncWorker.ts    |       0 |        0 |       0 |       0 | 25-47
 src/stores        |    4.65 |     2.24 |    2.65 |    4.82 |
  ...ore.svelte.ts |       0 |        0 |       0 |       0 | 10-377
  ...ore.svelte.ts |       0 |        0 |       0 |       0 | 12-442
  ...ore.svelte.ts |       0 |        0 |       0 |       0 | 58-1447
  ...rViewModel.ts |       0 |        0 |       0 |       0 | 4-366
  ...ore.svelte.ts |       0 |        0 |       0 |       0 | 10-44
  ...ore.svelte.ts |       0 |        0 |       0 |       0 | 3-44
  ...ore.svelte.ts |       0 |        0 |       0 |       0 | 5-69
  ...ore.svelte.ts |       0 |        0 |       0 |       0 | 4-26
  colorForUser.ts  |       0 |      100 |       0 |       0 | 2-6
  ...ore.svelte.ts |   15.88 |    10.86 |       4 |   15.96 | ...35-519,542-565
  ...ore.svelte.ts |       0 |        0 |       0 |       0 | 15-122
  store.svelte.ts  |    37.5 |    12.72 |   33.33 |    37.5 | ...91-192,209-257
  ...ore.svelte.ts |   12.82 |     3.22 |       0 |   13.15 | 10-64,160-185
 src/types         |       0 |        0 |       0 |       0 |
  global.d.ts      |       0 |        0 |       0 |       0 |
  sql.d.ts         |       0 |        0 |       0 |       0 |
  ...te5-shim.d.ts |       0 |        0 |       0 |       0 |
  y-protocols.d.ts |       0 |        0 |       0 |       0 |
  ...ugmented.d.ts |       0 |        0 |       0 |       0 |
  ...eredtree.d.ts |       0 |        0 |       0 |       0 |
  yjs-types.ts     |       0 |        0 |       0 |       0 | 71-155
 src/utils         |       0 |        0 |       0 |       0 |
  ...xFormatter.ts |       0 |        0 |       0 |       0 | 21-960
  ...ursorUtils.ts |       0 |        0 |       0 |       0 | 16-54
  graphUtils.ts    |       0 |        0 |       0 |       0 | 7-63
  ...ighlighter.ts |       0 |        0 |       0 |       0 | 7-43
  textUtils.ts     |       0 |        0 |       0 |       0 | 5-81
 src/yjs           |       0 |        0 |       0 |       0 |
  YjsClient.ts     |       0 |        0 |       0 |       0 | 31-210
-------------------|---------|----------|---------|---------|-------------------
