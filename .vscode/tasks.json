{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Start Development Server",
            "type": "npm",
            "script": "dev",
            "isBackground": true,
            "path": "client",
            "problemMatcher": {
                "owner": "custom",
                "pattern": {
                    "regexp": "^$"
                },
                "background": {
                    "beginsPattern": ".*start vite dev server.*",
                    "endsPattern": ".*ready in.*"
                }
            }
        },
        {
            "label": "Run E2E Tests with xvfb",
            "type": "shell",
            "command": "cd client && xvfb-run --auto-servernum --server-args=\"-screen 0 1280x960x24\" npm run test:e2e",
            "isBackground": true,
            "problemMatcher": []
        },
        {
            "label": "Watch and Run E2E Tests",
            "type": "shell",
            "command": "cd client && npx chokidar \"src/**/*.{ts,js,svelte}\" \"e2e/**/*.ts\" -c \"npm run test:e2e:debug\"",
            "isBackground": true,
            "problemMatcher": []
        },
        {
            "label": "Watch and Run E2E Tests with xvfb",
            "type": "shell",
            "command": "cd client && npx chokidar \"src/**/*.{ts,js,svelte}\" \"e2e/**/*.ts\" -c \"xvfb-run --auto-servernum --server-args=\\\"-screen 0 1280x960x24\\\" npm run test:e2e\"",
            "isBackground": true,
            "problemMatcher": []
        },
        {
            "label": "Start Development with Auto Tests",
            "dependsOn": [
                "Start Development Server",
                "Watch and Run E2E Tests with xvfb"
            ],
            "dependsOrder": "parallel",
            "group": {
                "kind": "test",
                "isDefault": true
            }
        },
        {
            "label": "Run E2E Auth Tests (Firebase)",
            "type": "shell",
            "command": "cd client && NODE_ENV=test dotenv -e .env.test -- xvfb-run --auto-servernum --server-args=\"-screen 0 1280x960x24\" playwright test --project=auth",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Run E2E Tests (Localhost)",
            "type": "shell",
            "command": "cd client && npm run test:e2e",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Run E2E Tests with Debug (Localhost)",
            "type": "shell",
            "command": "cd client && npm run test:e2e:debug",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Run E2E Tests with UI (Localhost)",
            "type": "shell",
            "command": "cd client && npm run test:e2e:ui",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Run E2E Tests with xvfb (Localhost)",
            "type": "shell",
            "command": "cd client && npm run test:e2e:xvfb",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Kill Tinylicious Process",
            "type": "shell",
            "command": "node ${workspaceFolder}/scripts/kill-tinylicious.js",
            "problemMatcher": [],
            "group": "none"
        },
        {
            "label": "clean-chrome-profile",
            "type": "shell",
            "command": "Remove-Item -Recurse -Force ${workspaceFolder}\\.vscode\\chrome-debug-profile"
            // Windows の場合は PowerShell: "Remove-Item -Recurse -Force ${workspaceFolder}\\.vscode\\chrome-debug-profile"
        },
        {
            "label": "npm: build - functions",
            "type": "npm",
            "script": "build",
            "path": "functions",
            "group": {
                "kind": "build",
                "isDefault": false
            },
            "problemMatcher": "$tsc"
        },
        {
            "label": "Kill Firebase Emulator",
            "type": "shell",
            "command": "pkill -f \"firebase emulators\" || true",
            "problemMatcher": [],
            "group": "none"
        },
        {
            "label": "Kill Production Firebase Emulators",
            "type": "shell",
            "command": "pkill -f \"firebase emulators.*outliner-d57b0\" || true",
            "problemMatcher": [],
            "group": "none"
        },
        {
            "label": "Start Firebase Functions Emulator",
            "type": "shell",
            "command": "cd ${workspaceFolder}/functions && firebase emulators:start --inspect-functions=9229 --only functions",
            "isBackground": true,
            "problemMatcher": {
                "owner": "custom",
                "pattern": {
                    "regexp": "^$"
                },
                "background": {
                    "beginsPattern": "Starting emulators",
                    "endsPattern": "All emulators ready"
                }
            }
        },
        {
            "label": "Start Production Firebase Emulators",
            "type": "shell",
            "command": "AZURE_TENANT_ID=89b298bd-9aa3-4a6b-8ef0-2dc3019b0996 AZURE_ENDPOINT=https://us.fluidrelay.azure.com AZURE_PRIMARY_KEY=AOPktmYTWatr1dnpTYlzKtwJdnH2JvetxZtvHVAenjoeQQGig58SJQQJ99BDACRsaBGy71xuAAAAAZFRCYsB AZURE_SECONDARY_KEY=G1uCB4aPknENH7HVHBwkd5lnUjrov8ZfejV2ieeUeaK0gZMuh6plJQQJ99BDACRsaBGy71xuAAAAAZFR25QJ AZURE_ACTIVE_KEY=primary firebase emulators:start --project outliner-d57b0",
            "isBackground": true,
            "problemMatcher": {
                "owner": "custom",
                "pattern": {
                    "regexp": "^$"
                },
                "background": {
                    "beginsPattern": "Starting emulators",
                    "endsPattern": "All emulators ready"
                }
            },
            "group": "none"
        },
        {
            "label": "Restart Production Firebase Emulators",
            "type": "shell",
            "command": "${workspaceFolder}/scripts/check-firebase-emulator.sh",
            "group": "none",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared"
            }
        }
    ],
    "compounds": [
        {
            "name": "Run Localhost E2E Tests",
            "dependsOn": [
                "Run E2E Tests (Localhost)"
            ],
            "dependsOrder": "sequence",
            "group": {
                "kind": "test",
                "isDefault": false
            }
        },
        {
            "name": "Run Localhost E2E Tests with UI",
            "dependsOn": [
                "Run E2E Tests with UI (Localhost)"
            ],
            "dependsOrder": "sequence",
            "group": {
                "kind": "test",
                "isDefault": false
            }
        }
    ]
}
