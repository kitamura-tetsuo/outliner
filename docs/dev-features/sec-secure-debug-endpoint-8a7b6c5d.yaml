id: ENV-8a7b6c5d
title: Secure Debug User Projects Endpoint
title-ja: デバッグ用ユーザープロジェクト確認エンドポイントのセキュア化
status: implemented
description: |
  Hardened the `debugUserProjects` endpoint to prevent unauthorized information disclosure.
  The endpoint now requires admin privileges, is disabled in production environments,
  and no longer returns internal environment variables.
vulnerability:
  type: Information Disclosure
  impact: |
    Exposure of internal environment variables (NODE_ENV, FUNCTIONS_EMULATOR)
    and unauthorized access to user project metadata.
solution: |
  - Updated `isAdmin` helper to correctly identify admin users via custom claims.
  - Added `isAdmin` authorization check to `debugUserProjects`.
  - Added production environment gate using `FUNCTIONS_EMULATOR` check.
  - Removed `environment` data from the API response payload.
tests:
  - functions/test/debug-endpoint-security.test.js
