id: ITM-yjs-keyboard-reorder-multi-7a9c2ef1
slug: itm-yjs-keyboard-reorder-multi-7a9c2ef1
title: Yjs Outliner - マルチカーソルでのAlt+矢印並べ替え
title-ja: Yjsアウトライナー - マルチカーソルでのAlt+矢印並べ替え
owner: client
area: outliner
status: active
summary: '/yjs-outliner ページで、Ctrl+Shift+Alt+ArrowDown/Up で複数カーソルを追加した状態でも、

  Alt+ArrowDown/Up による並べ替えは「最後に追加されたアクティブカーソルのアイテムのみ」を移動し、

  操作後はアクティブカーソルが1つに収束することをE2Eで担保する。

  '
rationale: '並べ替え操作の明確な主体を「最後に追加されたアクティブカーソル」に限定することで、

  予期しない複数同時移動によるUI混乱を避け、操作の一貫性を担保する。

  '
scope:
- /yjs-outliner ルートでの OutlinerBase レンダリング
- Ctrl+Shift+Alt+ArrowDown/Up によるマルチカーソル追加
- Alt+ArrowDown/Up による並べ替え（単一アイテム移動）
- 並べ替え後のアクティブカーソルの単一化
non_goals:
- 複数選択範囲での一括移動（別機能）
- 階層（インデント）移動（別機能）
impl_notes: "- E2E: client/e2e/new/itm-yjs-keyboard-reorder-multi-7a9c2ef1.spec.ts\n- EditorOverlayStore.addCursorRelativeToActive() でカーソル追加の基準位置を制御\n- KeyEventHandler の Alt+矢印並べ替えは editorOverlayStore.getLastActiveCursor() を優先し、\n  フォールバックとして isActive なカーソルの最後を選択する実装とする\n"
acceptance:
- Alt+ArrowDown を押すと最後に追加したカーソルのアイテムが1つ下に移動する
- Alt+ArrowUp を押すと最後に追加したカーソルのアイテムが1つ上に移動する
- Ctrl+Shift+Alt+ArrowDown で下方向にカーソルを追加できる
- Ctrl+Shift+Alt+ArrowUp で上方向にカーソルを追加できる
- 並べ替え後、アクティブカーソルが1つになっており、そのアイテムIDが移動後のアイテムに一致する
known_pitfalls:
- 並べ替え後の setCursor 再設定は非同期（rAF+timeout）であり、E2Eでは waitForFunction(active=1 かつ activeItemId の存在)で安定待ちすること。
- 複数カーソル時でも Alt+矢印で移動するのは「最後に追加されたアクティブカーソル」のみ。他のカーソルは移動させない。
- タイトル(index 0)は移動対象外。
