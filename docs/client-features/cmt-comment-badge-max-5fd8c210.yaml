id: CMT-5fd8c210
title: OutlinerItem comment badge reflects Yjs count (max logic)
title-ja: コメント数バッジは Yjs の件数（最大値ロジック）を表示する
description: 'OutlinerItem''s commentCountVisual uses the maximum value of the Yjs-derived
  value and the local fallback. Verify that when add/delete is performed on the Yjs
  side, the badge count increases/decreases accurately and displays the maximum value.

  '
category: comments
status: implemented
components:
- client/src/components/CommentThread.svelte
- client/src/components/OutlinerItem.svelte
impact:
- Improved visibility and consistency of comment counts
tradeoffs:
- The path for temporary overwriting by DOM fallback remains, so it is planned to be organized in the future
notes:
- Even when the thread is not expanded, the count is updated by observing Y.Array('comments') (minimal granularity Yjs observe)
tests:
- client/e2e/new/cmt-comment-badge-max-5fd8c210.spec.ts
