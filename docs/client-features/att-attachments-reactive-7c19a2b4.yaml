id: ATT-7c19a2b4
title: Attachments react to Yjs add/remove immediately
title-ja: 添付ファイルの追加・削除が即時に UI に反映される
description: 'Verify that add/remove operations on Item.attachments (Y.Array<string>)
  are immediately reflected in the OutlinerItem attachment preview. Works with minimal
  granularity Yjs observe (Y.Array/Y.Map) reflection and does not rely on external
  events or artificial delays.

  '
category: outliner
status: implemented
components:
- client/src/components/OutlinerItem.svelte
- client/src/schema/app-schema.ts
impact:
- Improved operational feel of attachment operations (immediacy)
tradeoffs:
- None (relies on minimal granularity Yjs observe)
notes:
- Since attachments supports both iterable/array, it is converted to array on UI side for rendering
- Migrated to observation mirror method (Yjs observe -> $state mirror), UI renders only mirror array
- E2E fallback reduced (removed 1px image and delay timer). During testing, drop -> model.addAttachment -> observe reflects immediately, leaving only minimal necessary test-only CustomEvent - injectAttachmentPreviewDom removed (DOM direct insertion preview abolished, unified to pure Yjs display)
tests:
- client/e2e/new/att-attachments-reactive-7c19a2b4.spec.ts
